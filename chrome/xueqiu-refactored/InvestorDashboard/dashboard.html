<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的投资看板</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="dashboard.css">
</head>
<body>
    <header>
        <h1><i class="fas fa-chart-line"></i> 数据看板</h1>
        <div class="header-actions">
            <button id="export-data-btn">导出数据 (备份)</button>
            <button id="import-data-btn">导入数据</button>
            <input type="file" id="import-file-input" style="display: none;" accept=".json">
            <button id="settle-btn">每日结算</button>
            <div class="time-display" id="last-update-time">
                <span class="time-digit-group">
                    <span class="time-digit" data-position="h1">0</span>
                    <span class="time-digit" data-position="h2">0</span>
                </span>时 
                <span class="time-digit-group">
                    <span class="time-digit" data-position="m1">0</span>
                    <span class="time-digit" data-position="m2">0</span>
                </span>分 
                <span class="time-digit-group">
                    <span class="time-digit" data-position="s1">0</span>
                    <span class="time-digit" data-position="s2">0</span>
                </span>秒
            </div>
        </div>
    </header>

    <main>
        <!-- 模块一: 仪表盘 -->
        <section class="dashboard-section">
            <div class="dashboard-header">
                <h2><i class="fas fa-wallet"></i> 资产总览</h2>
                <button id="toggle-privacy-btn">隐藏</button>
            </div>
            <div class="summary-grid">
                <div class="summary-card">
                    <span class="label">实时资产</span>
                    <span class="value" id="summary-realtime-assets">0.00</span>
                </div>
                <div class="summary-card">
                    <span class="label">昨日资产</span>
                    <span class="value editable" id="summary-yesterday-assets" contenteditable="true" title="点击编辑">0.00</span>
                </div>
                <div class="summary-card">
                    <span class="label">今日盈亏</span>
                    <span class="value" id="summary-today-pl">0.00 (0.00%)</span>
                </div>
                <div class="summary-card">
                    <span class="label">今年盈亏</span>
                    <span class="value" id="summary-ytd-pl">0.00 (0.00%)</span>
                </div>
                <div class="summary-card">
                    <span class="label">总成本</span>
                    <span class="value editable" id="summary-total-cost" contenteditable="true" title="点击编辑">1000000.00</span>
                </div>
            </div>
        </section>

        <!-- 模块二: 持仓与自选 -->
        <section class="portfolio-section">
            <div class="tabs" id="tabs-container">
                <!-- Tabs will be dynamically generated here -->
                <button class="tab-link" data-tab="tab-watchlist">自选股池</button>
                <button class="tab-link" data-tab="tab-calculator">交易计算</button>
                <button class="tab-link" data-tab="tab-total">总持仓</button>
                <button id="add-account-btn" title="添加新账户">+</button>
            </div>

            <div id="tab-total" class="tab-content">
                <table id="total-holdings-table"></table>
                
                <div class="asset-breakdown-section">
                    <h3><i class="fas fa-chart-pie"></i> 资产分解</h3>
                    <table id="asset-breakdown-table">
                        <thead>
                            <tr>
                                <th>描述</th>
                                <th>金额</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div class="actions">
                        <input type="text" id="add-breakdown-description" placeholder="输入描述，如：银行借贷">
                        <input type="number" id="add-breakdown-amount" placeholder="输入金额，负数表示负债" step="0.01">
                        <button id="add-breakdown-btn">添加条目</button>
                    </div>
                    
                    <div class="net-asset-summary">
                        <div class="summary-row">
                            <span class="label">总资产:</span>
                            <span class="value" id="total-assets-display">0.00</span>
                        </div>
                        <div class="summary-row">
                            <span class="label">减去负债和他人投资:</span>
                            <span class="value" id="total-deductions-display">0.00</span>
                        </div>
                        <div class="summary-row net-asset-row">
                            <span class="label">个人净资产:</span>
                            <span class="value" id="personal-net-assets-display">0.00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="accounts-content-container">
                 <!-- Account tabs content will be dynamically generated here -->
            </div>

            <div id="tab-watchlist" class="tab-content">
                <table id="watchlist-table"></table>
                <div class="actions">
                    <input type="text" id="add-code-watchlist" placeholder="输入6位股票代码" maxlength="6">
                    <button id="add-btn-watchlist">添加至股池</button>
                </div>
            </div>

            <div id="tab-calculator" class="tab-content">
                <div class="calculator-container">
                    <div class="calc-section" id="calc-stock-selector">
                        <label for="calc-stock-select">交易标的:</label>
                        <select id="calc-stock-select">
                            <option value="">-- 从自选股池选择 --</option>
                        </select>
                        <div class="price-display">
                            当前价格: <input type="number" id="calc-current-price" step="0.001" placeholder="0.00">
                            <button id="calc-reset-price-btn" title="重置为实时价格">重置</button>
                        </div>
                    </div>
            
                    <div class="calc-section">
                        <h4>通过金额计算仓位</h4>
                        <div class="calc-input-group">
                            <label for="calc-by-amount-input">金额</label>
                            <input type="number" id="calc-by-amount-input" class="calc-input" placeholder="目标金额">
                        </div>
                        <p>对应份额: <strong id="calc-by-amount-shares">0</strong> 股</p>
                        <p>对应仓位: <strong id="calc-by-amount-position">0.00%</strong></p>
                    </div>
            
                    <div class="calc-section">
                        <h4>通过份额计算仓位</h4>
                        <div class="calc-input-group">
                            <label for="calc-by-shares-input">份额</label>
                            <input type="number" id="calc-by-shares-input" class="calc-input" placeholder="目标份额">
                        </div>
                        <p>对应金额: <strong id="calc-by-shares-amount">0.00</strong> 元</p>
                        <p>对应仓位: <strong id="calc-by-shares-position">0.00%</strong></p>
                    </div>

                    <div class="calc-section">
                        <h4>通过仓位计算</h4>
                        <div class="calc-input-group">
                            <label for="calc-by-position-input">仓位(%)</label>
                            <input type="number" id="calc-by-position-input" class="calc-input" placeholder="目标仓位，如 5.5" step="0.01">
                        </div>
                        <p>对应金额: <strong id="calc-by-position-amount">0.00</strong> 元</p>
                        <p>对应份额: <strong id="calc-by-position-shares">0</strong> 股</p>
                    </div>
            
                    <div class="calc-section grid-calculator">
                        <h4>价格网格</h4>
                        <table>
                            <thead>
                                <tr><th>涨幅</th><th>目标价</th><th>跌幅</th><th>目标价</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><input type="number" class="grid-percent-input" data-row="0" data-type="up" value="1" step="0.1" min="-100">%</td>
                                    <td><input type="number" class="grid-price-input" data-row="0" data-type="up" step="0.001" min="0"></td>
                                    <td><input type="number" class="grid-percent-input" data-row="0" data-type="down" value="-1" step="0.1" max="100">%</td>
                                    <td><input type="number" class="grid-price-input" data-row="0" data-type="down" step="0.001" min="0"></td>
                                </tr>
                                <tr>
                                    <td><input type="number" class="grid-percent-input" data-row="1" data-type="up" value="2" step="0.1" min="-100">%</td>
                                    <td><input type="number" class="grid-price-input" data-row="1" data-type="up" step="0.001" min="0"></td>
                                    <td><input type="number" class="grid-percent-input" data-row="1" data-type="down" value="-2" step="0.1" max="100">%</td>
                                    <td><input type="number" class="grid-price-input" data-row="1" data-type="down" step="0.001" min="0"></td>
                                </tr>
                                <tr>
                                    <td><input type="number" class="grid-percent-input" data-row="2" data-type="up" value="3" step="0.1" min="-100">%</td>
                                    <td><input type="number" class="grid-price-input" data-row="2" data-type="up" step="0.001" min="0"></td>
                                    <td><input type="number" class="grid-percent-input" data-row="2" data-type="down" value="-3" step="0.1" max="100">%</td>
                                    <td><input type="number" class="grid-price-input" data-row="2" data-type="down" step="0.001" min="0"></td>
                                </tr>
                                <tr>
                                    <td><input type="number" class="grid-percent-input" data-row="3" data-type="up" value="5" step="0.1" min="-100">%</td>
                                    <td><input type="number" class="grid-price-input" data-row="3" data-type="up" step="0.001" min="0"></td>
                                    <td><input type="number" class="grid-percent-input" data-row="3" data-type="down" value="-5" step="0.1" max="100">%</td>
                                    <td><input type="number" class="grid-price-input" data-row="3" data-type="down" step="0.001" min="0"></td>
                                </tr>
                                <tr>
                                    <td><input type="number" class="grid-percent-input" data-row="4" data-type="up" value="10" step="0.1" min="-100">%</td>
                                    <td><input type="number" class="grid-price-input" data-row="4" data-type="up" step="0.001" min="0"></td>
                                    <td><input type="number" class="grid-percent-input" data-row="4" data-type="down" value="-10" step="0.1" max="100">%</td>
                                    <td><input type="number" class="grid-price-input" data-row="4" data-type="down" step="0.001" min="0"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
        </section>
        
        <!-- 模块三: 备注 -->
        <section class="notes-section">
            <h2><i class="fas fa-sticky-note"></i> 备注</h2>
            <textarea id="notes-textarea" placeholder="在此输入您的备注信息..."></textarea>
        </section>
    </main>

    <script type="module" src="dashboard.js"></script>
</body>
</html>