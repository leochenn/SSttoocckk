<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›ªçƒæ’ä»¶æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .test-section h3 {
            margin-top: 0;
            color: #555;
        }
        button {
            background-color: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background-color: #005a87;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
            font-weight: bold;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 3px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .mock-xueqiu {
            border: 2px solid #007cba;
            background-color: #fff;
            margin: 15px 0;
            padding: 15px;
        }
        .mock-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }
        .mock-message-link {
            position: relative;
            color: #007cba;
            text-decoration: none;
            padding: 5px 10px;
        }
        .mock-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #dc3545;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”” é›ªçƒæ¶ˆæ¯ç›‘æ§åŠ©æ‰‹ - æµ‹è¯•é¡µé¢</h1>
        
        <div class="test-section">
            <h3>ğŸ“‹ æ’ä»¶çŠ¶æ€æ£€æŸ¥</h3>
            <button onclick="checkPluginStatus()">æ£€æŸ¥æ’ä»¶çŠ¶æ€</button>
            <button onclick="testNotification()">æµ‹è¯•é€šçŸ¥åŠŸèƒ½</button>
            <button onclick="debugDOM()">è°ƒè¯•DOMç»“æ„</button>
            <div id="pluginStatus" class="status info">ç‚¹å‡»æŒ‰é’®æ£€æŸ¥æ’ä»¶çŠ¶æ€</div>
        </div>

        <div class="test-section">
            <h3>ğŸ§ª æ¨¡æ‹Ÿé›ªçƒé¡µé¢ç»“æ„</h3>
            <p>è¿™ä¸ªåŒºåŸŸæ¨¡æ‹Ÿé›ªçƒç½‘ç«™çš„æ¶ˆæ¯é€šçŸ¥ç»“æ„ï¼Œç”¨äºæµ‹è¯•æ’ä»¶çš„æ£€æµ‹èƒ½åŠ›ï¼š</p>
            
            <div class="mock-xueqiu">
                <div class="mock-nav">
                    <div>é›ªçƒæ¨¡æ‹Ÿå¯¼èˆª</div>
                    <div>
                        <a href="#" class="mock-message-link">
                            æˆ‘çš„æ¶ˆæ¯
                            <span id="mockBadge" class="mock-badge">1</span>
                        </a>
                    </div>
                </div>
                <p>è¿™æ˜¯æ¨¡æ‹Ÿçš„é›ªçƒé¡µé¢å†…å®¹åŒºåŸŸ</p>
            </div>
            
            <button onclick="changeMockCount(1)">å¢åŠ æ¶ˆæ¯æ•°é‡</button>
            <button onclick="changeMockCount(-1)">å‡å°‘æ¶ˆæ¯æ•°é‡</button>
            <button onclick="changeMockCount(0)">é‡ç½®ä¸º0</button>
        </div>

        <div class="test-section">
            <h3>ğŸ” æ‰‹åŠ¨è§¦å‘æ£€æŸ¥</h3>
            <button onclick="triggerManualCheck()">æ‰‹åŠ¨æ£€æŸ¥æ›´æ–°</button>
            <button onclick="getSettings()">è·å–å½“å‰è®¾ç½®</button>
            <div id="manualCheckResult" class="status info">ç‚¹å‡»æŒ‰é’®è¿›è¡Œæ‰‹åŠ¨æ£€æŸ¥</div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š å®æ—¶æ—¥å¿—</h3>
            <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
            <button onclick="startLogMonitoring()">å¼€å§‹ç›‘æ§æ—¥å¿—</button>
            <button onclick="stopLogMonitoring()">åœæ­¢ç›‘æ§æ—¥å¿—</button>
            <div id="logContainer" class="log">æ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
        </div>
    </div>

    <script>
        let logMonitorInterval = null;
        let mockMessageCount = 1;

        // æ£€æŸ¥æ’ä»¶çŠ¶æ€
        function checkPluginStatus() {
            const statusDiv = document.getElementById('pluginStatus');
            
            if (typeof chrome !== 'undefined' && chrome.runtime && chrome.runtime.id) {
                statusDiv.className = 'status success';
                statusDiv.textContent = 'âœ… æ’ä»¶å·²åŠ è½½ï¼Œè¿è¡Œç¯å¢ƒæ­£å¸¸';
                
                // å°è¯•ä¸background scripté€šä¿¡
                chrome.runtime.sendMessage({action: 'ping'}, (response) => {
                    if (chrome.runtime.lastError) {
                        statusDiv.className = 'status error';
                        statusDiv.textContent = 'âŒ æ’ä»¶å·²åŠ è½½ä½†åå°è„šæœ¬æ— å“åº”: ' + chrome.runtime.lastError.message;
                    } else {
                        statusDiv.className = 'status success';
                        statusDiv.textContent = 'âœ… æ’ä»¶å®Œå…¨æ­£å¸¸ï¼Œåå°è„šæœ¬å“åº”æ­£å¸¸';
                    }
                });
            } else {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ æ’ä»¶æœªåŠ è½½æˆ–è¿è¡Œç¯å¢ƒå¼‚å¸¸';
            }
        }

        // æµ‹è¯•é€šçŸ¥åŠŸèƒ½
        function testNotification() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({
                    action: 'testNotification',
                    data: { message: 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•é€šçŸ¥' }
                }, (response) => {
                    const statusDiv = document.getElementById('pluginStatus');
                    if (chrome.runtime.lastError) {
                        statusDiv.className = 'status error';
                        statusDiv.textContent = 'âŒ é€šçŸ¥æµ‹è¯•å¤±è´¥: ' + chrome.runtime.lastError.message;
                    } else {
                        statusDiv.className = 'status success';
                        statusDiv.textContent = 'âœ… é€šçŸ¥æµ‹è¯•æˆåŠŸï¼Œè¯·æŸ¥çœ‹ç³»ç»Ÿé€šçŸ¥';
                    }
                });
            } else {
                alert('æ’ä»¶ç¯å¢ƒä¸å¯ç”¨ï¼Œæ— æ³•æµ‹è¯•é€šçŸ¥');
            }
        }

        // è°ƒè¯•DOMç»“æ„
        function debugDOM() {
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({
                    action: 'debugDOM'
                }, (response) => {
                    const statusDiv = document.getElementById('pluginStatus');
                    if (chrome.runtime.lastError) {
                        statusDiv.className = 'status error';
                        statusDiv.textContent = 'âŒ DOMè°ƒè¯•å¤±è´¥: ' + chrome.runtime.lastError.message;
                    } else {
                        statusDiv.className = 'status success';
                        statusDiv.textContent = 'âœ… DOMè°ƒè¯•å®Œæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—';
                        logMessage('DOMè°ƒè¯•å·²è§¦å‘ï¼Œè¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°');
                    }
                });
            } else {
                alert('æ’ä»¶ç¯å¢ƒä¸å¯ç”¨ï¼Œæ— æ³•è°ƒè¯•DOM');
            }
        }

        // æ”¹å˜æ¨¡æ‹Ÿæ¶ˆæ¯æ•°é‡
        function changeMockCount(change) {
            if (change === 0) {
                mockMessageCount = 0;
            } else {
                mockMessageCount = Math.max(0, mockMessageCount + change);
            }
            
            const badge = document.getElementById('mockBadge');
            if (mockMessageCount === 0) {
                badge.style.display = 'none';
            } else {
                badge.style.display = 'flex';
                badge.textContent = mockMessageCount;
            }
            
            logMessage(`æ¨¡æ‹Ÿæ¶ˆæ¯æ•°é‡å˜æ›´ä¸º: ${mockMessageCount}`);
        }

        // æ‰‹åŠ¨è§¦å‘æ£€æŸ¥
        function triggerManualCheck() {
            const resultDiv = document.getElementById('manualCheckResult');
            
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({
                    action: 'manualCheck'
                }, (response) => {
                    if (chrome.runtime.lastError) {
                        resultDiv.className = 'status error';
                        resultDiv.textContent = 'âŒ æ‰‹åŠ¨æ£€æŸ¥å¤±è´¥: ' + chrome.runtime.lastError.message;
                    } else {
                        resultDiv.className = 'status success';
                        resultDiv.textContent = 'âœ… æ‰‹åŠ¨æ£€æŸ¥å®Œæˆï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—';
                        logMessage('æ‰‹åŠ¨æ£€æŸ¥å·²è§¦å‘');
                    }
                });
            } else {
                resultDiv.className = 'status error';
                resultDiv.textContent = 'âŒ æ’ä»¶ç¯å¢ƒä¸å¯ç”¨';
            }
        }

        // è·å–å½“å‰è®¾ç½®
        function getSettings() {
            const resultDiv = document.getElementById('manualCheckResult');
            
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({
                    action: 'getSettings'
                }, (response) => {
                    if (chrome.runtime.lastError) {
                        resultDiv.className = 'status error';
                        resultDiv.textContent = 'âŒ è·å–è®¾ç½®å¤±è´¥: ' + chrome.runtime.lastError.message;
                    } else {
                        resultDiv.className = 'status info';
                        resultDiv.textContent = 'ğŸ“‹ å½“å‰è®¾ç½®: ' + JSON.stringify(response, null, 2);
                        logMessage('å½“å‰è®¾ç½®: ' + JSON.stringify(response, null, 2));
                    }
                });
            } else {
                resultDiv.className = 'status error';
                resultDiv.textContent = 'âŒ æ’ä»¶ç¯å¢ƒä¸å¯ç”¨';
            }
        }

        // æ—¥å¿—ç›¸å…³åŠŸèƒ½
        function logMessage(message) {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            logContainer.innerHTML += `[${timestamp}] ${message}\n`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function clearLog() {
            document.getElementById('logContainer').innerHTML = 'æ—¥å¿—å·²æ¸…ç©º...\n';
        }

        function startLogMonitoring() {
            if (logMonitorInterval) {
                clearInterval(logMonitorInterval);
            }
            
            logMessage('å¼€å§‹ç›‘æ§æ’ä»¶æ—¥å¿—...');
            
            // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„æ—¥å¿—ç›‘æ§é€»è¾‘
            logMonitorInterval = setInterval(() => {
                // æ¨¡æ‹Ÿæ—¥å¿—ç›‘æ§
                if (Math.random() > 0.8) {
                    logMessage('æ¨¡æ‹Ÿæ—¥å¿—: æ’ä»¶æ­£åœ¨è¿è¡Œ...');
                }
            }, 3000);
        }

        function stopLogMonitoring() {
            if (logMonitorInterval) {
                clearInterval(logMonitorInterval);
                logMonitorInterval = null;
                logMessage('æ—¥å¿—ç›‘æ§å·²åœæ­¢');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥æ’ä»¶çŠ¶æ€
        window.addEventListener('load', () => {
            setTimeout(checkPluginStatus, 1000);
            logMessage('æµ‹è¯•é¡µé¢å·²åŠ è½½');
        });
    </script>
</body>
</html>